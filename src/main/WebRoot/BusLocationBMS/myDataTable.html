<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <!--为了保证在移动端能够正常的显示-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- 导入Bootstrap的CSS文件 -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <!--导入字体图标-->
    <link rel="stylesheet" href="font/iconfont.css">
    <!--导入less文件-->
    <link rel="stylesheet/less" href="css/myDataTable.less">
    <script src="js/less.js"></script>
    <title>example</title>
    <script src="js/axios.min.js"></script>
</head>
<body>
<div class="table-responsive">
    <table class="table table-striped table-sm myDataTable" id="dataTable">
        <thead>
        <tr>
            <th>#</th>
            <th>部门名</th>
            <th>姓名</th>
            <th>电话号码</th>
            <th>身份证</th>
            <th>职工编号</th>
            <th>邮箱</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <th>1</th>
            <td>财务部</td>
            <td>张三</td>
            <td>156981654</td>
            <td>332624199812102110</td>
            <td>xb16620216</td>
            <td>1445830802@qq.com</td>
            <td>
                <a href="#" class="delete"><i class="iconfont icon-delete"></i></a>
                <a href="#" class="modify"><i class="iconfont icon-xiugai"></i></a>
            </td>
        </tr>
        <tr>
            <th>1</th>
            <td>财务部</td>
            <td>张三</td>
            <td>156981654</td>
            <td>332624199812102110</td>
            <td>xb16620216</td>
            <td>1445830802@qq.com</td>
            <td>
                <a href="#" class="delete"><i class="iconfont icon-delete"></i></a>
                <a href="#" class="modify"><i class="iconfont icon-xiugai"></i></a>
            </td>
        </tr>
        <tr>
            <th>1</th>
            <td>财务部</td>
            <td>张三</td>
            <td>156981654</td>
            <td>332624199812102110</td>
            <td>xb16620216</td>
            <td>1445830802@qq.com</td>
            <td>
                <a href="#" class="delete"><i class="iconfont icon-delete"></i></a>
                <a href="#" class="modify"><i class="iconfont icon-xiugai"></i></a>
            </td>
        </tr>
        <tr>
            <th>1</th>
            <td>财务部</td>
            <td>张三</td>
            <td>156981654</td>
            <td>332624199812102110</td>
            <td>xb16620216</td>
            <td>1445830802@qq.com</td>
            <td>
                <a href="#" class="delete"><i class="iconfont icon-delete"></i></a>
                <a href="#" class="modify"><i class="iconfont icon-xiugai"></i></a>
            </td>
        </tr>
        <tr>
            <th>1</th>
            <td>财务部</td>
            <td>张三</td>
            <td>156981654</td>
            <td>332624199812102110</td>
            <td>xb16620216</td>
            <td>1445830802@qq.com</td>
            <td>
                <a href="#" class="delete"><i class="iconfont icon-delete"></i></a>
                <a href="#" class="modify"><i class="iconfont icon-xiugai"></i></a>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="js/jquery-3.1.1.js"></script>
<!--在Bootstrap4中很多的提示/弹窗都是通过popper.min.js实现的, 所以需要导入-->
<script src="js/popper.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script src="js/bootstrap.js"></script>
<!--添加自己的数据表插件-->
<script src="js/myDataTable.js"></script>
<script>
    //设置根路径
    axios.defaults.baseURL = 'http://172.20.10.2:8080/busposition';
    //创建数据表
    let dt = new MyDataTable({
        selector: '#dataTable',
        rowSize: 10,
        pageNumber: 2,
        showOrder: true,
        showOperator: true,
        titles: {
                    departmentName: '部门名',
                    realName: '真实姓名',
                    phone: '电话号码',
                    idCode: '身份证',
                    workId: '职工编号',
                    email: '邮箱'
                },
    });
    freshDataTable(dt,2);
    let oDeletBtns = $('.myDataTable .delete');
    //监听删除按钮点击事件
    oDeletBtns.click(function(){
        let oTr = $(this).parents('tr');
        let id = dt.getId(oTr);
        deleteDataRow(dt,id);
    });
    //删除数据项
    function deleteDataRow(dataTable,id){
        console.log(id);
        //发送ajax
        axios.post('/admin/del/id',`userId=${id}`)
                    .then(function(response){
                        return response.data;
                    })
                    .then(function(obj){
                        if(obj.success){
                            let pageNumber = dataTable.getPageNumber();
                            freshDataTable(dataTable,pageNumber);
                        }else {
                            console.log(obj.message);
                        }
                    })
                    .catch(function(e){
                        console.log(e);
            })
    }
    //刷新数据表
    function freshDataTable(dataTable,pageNumber){
        axios.post('/admin/info/list/pages','pageNow=2&pageSize=10')
            .then(function(res){
                return res.data;
            })
            .then(function(obj){
                if(obj.success){
                    let data = obj.data;
                    dataTable.fillDataRow(data,pageNumber);
                }else {
                    console.log(obj.message);
                }
            })
            .catch(function(e){
            console.log(e);
        });
    }


</script>
</body>
</html>